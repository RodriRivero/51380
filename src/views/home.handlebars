<h1 style="text-align: center;" class="mt-2">Lista de Productos</h1>


<div class="container mt-2 animate__animated animate__fadeInUp m-3 " id="ulContainer ">
    <div class="d-flex justify-content-center row  m-4"  >
        {{#each products as |product|}}
        <div  id="{{product.id}}"  class="col-md-7 mb-3">
            <div id="cont" class="row p-1  rounded-4">
                <div class="col-md-3 m-0 "><img  class="img-fluid img-responsive rounded product-image rounded-4" src="{{product.thumbnails}}"></div>

                <div id="cont" class=" col-md-5 mt-0 bg-white  pt-4 rounded-3"> 

                    <h5 class="" id="titleRealTime" > title:{{product.title}}</h5>

                    <div class="d-flex flex-row ">

                    <span> stock:{{product.stock}}</span>
                    </div>
                    <div class="mt-1 mb-1 spec-1"><span  id="descRealTime" > description{{product.desc}}</span></div>
                    <div class="mt-1 mb-1 spec-1"><span id="priceRealTime">price${{product.price}}</span></div>
                </div>
                <div class="align-items-center align-content-center col-md-3 border-center mt-3">
                    <div class="d-flex flex-column mt-2"><button class="btn btn-primary btn-sm rounded-5" type="button">Added to cart</button>
                    <div class="d-flex flex-column mt-2"><button class="btn btn-primary btn-sm rounded-5" type="button">Update</button>
                    <div  href="#" class="d-flex flex-column mt-2"><button class="btn btn-primary btn-sm rounded-5" type="button">Buy</button>
                    <button href="#" class="btn btn-outline-danger btn-sm mt-2 rounded-5"  onclick='eliminateProduct("{{product.id}}")' type="button">Delete</button></div>
                </div>
              </div>
            </div>
        </div>
    </div>
    {{/each}}
</div>





<script>
  const formProduct = document.getElementById('formProducts')
  const divContainer = document.getElementById('ulContainer')
  
  formProduct.addEventListener('submit', async (event) => {
    event.preventDefault()
    event.stopPropagation()
    
    const inputTitle = document.getElementById('inputTitle').value
    const inputDescription = document.getElementById('inputDescription').value
    const inputPrice = document.getElementById('inputPrice').value
    const inputCode = document.getElementById('inputCode').value
    const inputStock = document.getElementById('inputStock').value
    const errorAlert = document.getElementById('errorAlert')
    const newProduct = {
        title: inputTitle,
        desc: inputDescription,
        price: inputPrice,
        code: inputCode,
        stock: inputStock
      }
    

    const response = await fetch('/api/products', {
      method: "POST",
      body: JSON.stringify(newProduct),
      headers: {
        'content-type': 'application/json'
      }
    })
    if(response.ok) {
      errorAlert.style.color = 'green'
      errorAlert.innerText = 'Product added with sucess'
      const data = await response.json()

      let div = document.createElement('div')
      div.setAttribute ('id', data.payload.id)
      div.innerHTML = `<div  class="card my-2 mx-2" style="width: 18rem; flex-grow: 1;">
      <img src="${data.payload.thumbnails}" class="card-img-top" alt="Imagen ilustrativa" id="imageRealTime">
      <div class="card-body">
        <h5 class="card-title text-center" id="titleRealTime">${data.payload.title}</h5>
        <p class="card-text text-center" id="descRealTime">${data.payload.desc}</p>
        <p class="card-text text-center pb-2" id="priceRealTime">Price: $${data.payload.price}</p>
        <div class="mx-2 mb-2 d-flex justify-content-around">
          <a href="#" class="btn btn-secondary">Buy</a>
          <a href="#" class="btn btn-danger" onclick='eliminateProduct("${data.payload.id}")'>Delete</a>
        </div>
        </div>
        </div>`
      divContainer.appendChild(div)
      formProduct.reset()
    } else {
      const data = await response.json()
      errorAlert.style.color = 'red'
      errorAlert.innerText = data.error
    }   
  })

  async function eliminateProduct(id) {
    try {
      const response = await fetch('/api/products/' + id, {
      method: "DELETE"
    })
    const div = document.getElementById(id)
    div.remove()
    } catch (err) {
      return
    }
  }
</script>

